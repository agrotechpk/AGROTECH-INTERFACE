<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Agrotech Corporate Interface</title>

<style>
    body {
        margin: 0;
        padding: 0;
        font-family: "Century Gothic", Arial, sans-serif;
        background: #d9d9d9;
        color: #0050a8;
    }

    .page-wrapper {
        min-height: 100vh;
        display: flex;
        justify-content: center;
        padding: 40px 0;
    }

    .card-container {
        width: 90%;
        max-width: 1200px;
        text-align: center;
    }

    /* TOP BAR */
    .topbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 56px;
        background: #ffffff;
        border-bottom: 1px solid rgba(0,0,0,0.08);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 16px;
        z-index: 100;
    }

    .topbar-left {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .topbar-logo {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        overflow: hidden;
    }

    .topbar-logo img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }

    .topbar-title {
        font-weight: 600;
        font-size: 16px;
        color: #0050a8;
    }

    .topbar-middle {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .entity-switch {
        display: flex;
        border-radius: 20px;
        overflow: hidden;
        border: 1px solid #0050a8;
    }

    .entity-btn {
        padding: 4px 12px;
        font-size: 13px;
        cursor: pointer;
        border: none;
        background: transparent;
        color: #0050a8;
    }

    .entity-btn.active {
        background: #0050a8;
        color: #ffffff;
    }

    .search-box {
        padding: 4px 10px;
        border-radius: 16px;
        border: 1px solid rgba(0,0,0,0.3);
        font-size: 13px;
        min-width: 220px;
    }

    .topbar-right {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
    }

    .user-label {
        opacity: 0.8;
    }

    .btn-pill {
        padding: 4px 10px;
        border-radius: 16px;
        border: 1px solid #0050a8;
        background: #ffffff;
        color: #0050a8;
        cursor: pointer;
        font-size: 12px;
    }

    .btn-pill:hover {
        background: #0050a8;
        color: #ffffff;
    }

    /* LOGIN SCREEN – FULL WHITE OVERLAY */
    #screen-login {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #ffffff; /* pure white */
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
    }

    .login-card {
        background: #ffffff;
        border-radius: 16px;
        padding: 30px 30px 24px;
        max-width: 360px;
        width: 90%;
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        text-align: left;
    }

    .login-card h2 {
        margin-top: 0;
        margin-bottom: 8px;
        text-align: left;
    }

    .login-subtitle {
        font-size: 13px;
        opacity: 0.8;
        margin-bottom: 20px;
    }

    .login-field {
        margin-bottom: 14px;
        text-align: left;
    }

    .login-field label {
        display: block;
        font-size: 13px;
        margin-bottom: 4px;
    }

    .login-field input {
        width: 100%;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid rgba(0,0,0,0.25);
        font-family: inherit;
        font-size: 13px;
    }

    .login-btn {
        margin-top: 10px;
        width: 100%;
        padding: 8px 10px;
        border-radius: 999px;
        border: none;
        background: #0050a8;
        color: #ffffff;
        font-size: 14px;
        cursor: pointer;
        font-weight: 600;
    }

    .login-btn:hover {
        opacity: 0.9;
    }

    .login-error {
        color: #b00020;
        font-size: 12px;
        min-height: 16px;
        margin-top: 4px;
    }

    /* CONTENT AREA (below topbar) */
    .content-wrapper {
        padding-top: 70px; /* space for fixed top bar */
    }

    .logo-main img {
        width: 908px;
        height: 267px;
        object-fit: contain;
        margin-bottom: 20px;
    }

    h1, h2 {
        margin-bottom: 25px;
        color: #0050a8;
    }

    .breadcrumb {
        font-size: 13px;
        opacity: 0.8;
        margin-bottom: 10px;
        text-align: left;
    }

    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 20px;
        justify-items: center;
    }

    .card {
        background: rgba(74, 158, 43, 0.20);
        border-radius: 12px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.15s ease;
        width: 100%;
        max-width: 350px;
        min-height: 120px;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
    }

    .card:hover {
        transform: translateY(-4px);
        box-shadow: 0px 6px 18px rgba(0,0,0,0.25);
    }

    .entity-card {
        background: transparent;
        padding: 0;
        min-height: auto;
        box-shadow: none;
    }

    .entity-card:hover {
        box-shadow: none;
        transform: none;
    }

    .entity-frame {
        width: 100%;
        max-width: 551px;
        aspect-ratio: 551 / 248;
        border: 2px solid #0050a8;
        border-radius: 0;   /* NO ROUND CORNERS */
        background: rgba(74, 158, 43, 0.20);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: box-shadow 0.25s ease, transform 0.25s ease;
    }

    .entity-frame:hover {
        box-shadow: 0 0 18px rgba(0, 80, 168, 0.45);
        transform: translateY(-2px);
    }

    .entity-logo {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }

    /* ===== MOBILE FIX (ENTITY LOGOS) ===== */
    @media (max-width: 480px) {

        .entity-frame {
            width: 95% !important;
            aspect-ratio: unset !important;
            height: auto !important;
            padding: 10px !important;
        }

        .entity-logo {
            width: 100% !important;
            height: auto !important;
        }

        #screen-companies .grid {
            grid-template-columns: 1fr !important;
            gap: 20px !important;
        }
    }

    .sub-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
        gap: 15px;
        margin-top: 25px;
        width: 100%;
    }

    .sub-card {
        background: rgba(74, 158, 43, 0.20);
        border-radius: 10px;
        padding: 14px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        font-size: 15px;
        text-align: left;
        cursor: pointer;
        transition: all 0.12s ease;
    }

    .sub-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.22);
    }

    .back-btn {
        padding: 6px 16px;
        border: 1px solid #0050a8;
        background: white;
        border-radius: 20px;
        color: #0050a8;
        cursor: pointer;
        margin-bottom: 20px;
    }

    .back-btn:hover {
        background: #0050a8;
        color: white;
    }

    .hidden {
        display: none;
    }

    /* ===== MOBILE FIX (LOGIN CARD) ===== */
    @media (max-width: 480px) {
        .login-card {
            max-width: 90% !important;
            padding: 20px !important;
        }

        .login-card img {
            width: 180px !important;
        }

        .login-card h2 {
            font-size: 18px !important;
        }

        .login-field input {
            font-size: 14px !important;
            padding: 10px !important;
        }

        .login-btn {
            font-size: 14px !important;
            padding: 10px !important;
        }
    }

    /* ===== MOBILE FIX (DEPARTMENTS GRID) ===== */
    @media (max-width: 768px) {

        #dept-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important;
            gap: 15px !important;
        }

        #dept-grid .card {
            min-height: 90px !important;
            padding: 14px !important;
            font-size: 15px !important;
        }
    }

    @media (max-width: 480px) {

        #dept-grid {
            grid-template-columns: 1fr !important; /* one per row */
            gap: 12px !important;
        }

        #dept-grid .card {
            min-height: 80px !important;
            font-size: 14px !important;
        }
    }

    /* ===== MOBILE FIX (SUBFOLDER GRID) ===== */

    @media (max-width: 768px) {

        .sub-grid {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)) !important;
            gap: 14px !important;
        }

        .sub-card {
            font-size: 14px !important;
            padding: 12px !important;
        }
    }

    @media (max-width: 480px) {

        .sub-grid {
            grid-template-columns: 1fr !important;   /* one per row */
            gap: 10px !important;
        }

        .sub-card {
            font-size: 13px !important;
            padding: 12px !important;
        }
    }

    /* ===== MOBILE FIX (TOPBAR & SEARCH BAR) ===== */
    @media (max-width: 768px) {

        .topbar {
            height: auto !important;
            padding: 8px 10px !important;
            flex-wrap: wrap !important;
            gap: 6px !important;
            justify-content: center !important;
            text-align: center !important;
        }

        .topbar-left,
        .topbar-middle,
        .topbar-right {
            width: 100% !important;
            justify-content: center !important;
            text-align: center !important;
        }

        .search-box {
            min-width: 160px !important;
            width: 70% !important;
            font-size: 14px !important;
        }

        .entity-switch {
            transform: scale(0.9);
        }

        .btn-pill {
            padding: 5px 12px !important;
            font-size: 13px !important;
        }

        .user-label {
            font-size: 12px !important;
            display: block;
        }
    }

    @media (max-width: 480px) {

        .topbar {
            padding: 6px 6px !important;
        }

        .search-box {
            width: 90% !important;
            min-width: unset !important;
        }

        .entity-switch {
            transform: scale(0.85);
        }
    }

    /* ===== MOBILE FIX (MAIN LOGO + CONTENT WRAPPER) ===== */
    @media (max-width: 768px) {

        .logo-main img {
            width: 90% !important;
            height: auto !important;
            max-width: 500px !important;
            margin-bottom: 10px !important;
        }

        .page-wrapper {
            padding: 20px 0 !important;
        }

        .card-container {
            width: 95% !important;
        }
    }

    @media (max-width: 480px) {

        .logo-main img {
            width: 95% !important;
            height: auto !important;
            max-width: 350px !important;
        }

        .page-wrapper {
            padding: 15px 0 !important;
        }

        h1, h2 {
            font-size: 20px !important;
            margin-bottom: 18px !important;
        }
    }

</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="screen-login">
    <div class="login-card">

        <!-- LOGIN PAGE LOGO (WHITE BG) -->
        <div style="text-align:center; margin-bottom:20px;">
            <img src="images/login_logo.png" style="width:260px; object-fit:contain;">
        </div>

        <h2>Agrotech Interface Login</h2>
        <div class="login-subtitle">
            Secure access for Agrotech UAE &amp; Agrotech Pakistan.
        </div>

        <div class="login-field">
            <label for="login-username">Username</label>
            <input type="text"
                   id="login-username"
                   autocomplete="off"
                   autocapitalize="off"
                   spellcheck="false"
                   placeholder="">
        </div>

        <div class="login-field">
            <label for="login-password">Password</label>
            <input type="password"
                   id="login-password"
                   autocomplete="off"
                   placeholder="">
        </div>

        <button class="login-btn" onclick="handleLogin()">Sign in</button>
        <div class="login-error" id="login-error"></div>
    </div>
</div>

<!-- TOP BAR (shown after login) -->
<div class="topbar hidden" id="topbar">
    <div class="topbar-left">
        <div class="topbar-logo">
            <!-- topbar also uses login logo (white background) -->
            <img src="images/login_logo.png" alt="Agrotech">
        </div>
        <div class="topbar-title">Agrotech Corporate Dashboard</div>
    </div>

    <div class="topbar-middle">
        <div class="entity-switch">
            <button class="entity-btn active" id="btn-uae" onclick="switchEntity('UAE')">UAE</button>
            <button class="entity-btn" id="btn-pk" onclick="switchEntity('PK')">Pakistan</button>
        </div>
        <input type="text" id="searchBox" class="search-box"
               placeholder="Search departments & folders..."
               oninput="handleSearch(this.value)">
    </div>

    <div class="topbar-right">
        <button class="btn-pill" onclick="goToMainMenu()">Main menu</button>
        <span class="user-label" id="user-label"></span>
        <button class="btn-pill" onclick="handleLogout()">Logout</button>
    </div>
</div>

<!-- MAIN CONTENT -->
<div class="content-wrapper hidden" id="main-content">
<div class="page-wrapper">
<div class="card-container">

    <!-- MAIN TOP LOGO (grey background, big company logo) -->
    <div class="logo-main">
        <img id="main-logo" src="images/company_logo.png" alt="Agrotech Group">
    </div>

    <!-- SCREEN 1: ENTITY SELECT -->
    <div id="screen-companies">
        <h1>Select Entity</h1>
        <div class="grid">
            <div class="card entity-card" onclick="openDepartments('UAE')">
                <div class="entity-frame">
                    <img src="images/agrotech_uae.png" class="entity-logo" alt="Agrotech UAE">
                </div>
            </div>
            <div class="card entity-card" onclick="openDepartments('PK')">
                <div class="entity-frame">
                    <img src="images/agrotech_pakistan.png" class="entity-logo" alt="Agrotech Pakistan">
                </div>
            </div>
        </div>
    </div>

    <!-- SCREEN 2: DEPARTMENTS -->
    <div id="screen-departments" class="hidden">
        <button class="back-btn" onclick="goBackToCompanies()">← Back</button>
        <div class="breadcrumb" id="dept-breadcrumb"></div>
        <h2>Departments</h2>

        <div class="grid" id="dept-grid">
            <div class="card" data-label="administration admin office" onclick="openSub('Administration')">Administration</div>
            <div class="card" data-label="legal compliance law license moa" onclick="openSub('LegalCompliance')">Legal &amp; Compliance</div>
            <div class="card" data-label="finance accounting accounts acc payables receivables" onclick="openSub('FinanceAccounting')">Finance &amp; Accounting</div>
            <div class="card" data-label="procurement purchasing purchase sourcing" onclick="openSub('Procurement')">Procurement</div>
            <div class="card" data-label="operations ops plant factory" onclick="openSub('Operations')">Operations</div>
            <div class="card" data-label="sales marketing salesmarketing crm" onclick="openSub('SalesMarketing')">Sales &amp; Marketing</div>
            <div class="card" data-label="human resources hr employees" onclick="openSub('HR')">Human Resources (HR)</div>
            <div class="card" data-label="projects project jobs" onclick="openSub('Projects')">Projects</div>
            <div class="card" data-label="it systems information technology" onclick="openSub('ITSystems')">IT &amp; Systems</div>
            <div class="card" data-label="assets inventory fixed assets" onclick="openSub('AssetsInventory')">Assets &amp; Inventory</div>
            <div class="card" data-label="intercompany uae pakistan transfers" onclick="openSub('Intercompany')">Intercompany (UAE ↔ Pakistan)</div>
            <div class="card" data-label="directors ownership shareholders" onclick="openSub('DirectorsOwnership')">Directors &amp; Ownership</div>
            <div class="card" data-label="research development r&d rnd" onclick="openSub('RnD')">Research &amp; Development (R&amp;D)</div>
            <div class="card" data-label="product hunting sourcing china usa vendors" onclick="openSub('ProductSourcing')">Product Hunting &amp; Sourcing</div>
            <div class="card" data-label="archive old closed" onclick="openSub('Archive')">Archive (Old / Closed Files)</div>
        </div>
    </div>

    <!-- SCREEN 3: SUBFOLDERS -->
    <div id="screen-sub" class="hidden">
        <button class="back-btn" onclick="goBackToDepartments()">← Back</button>
        <div class="breadcrumb" id="sub-breadcrumb"></div>
        <h2 id="sub-title"></h2>

        <!-- ADMINISTRATION -->
        <div id="sub-Administration" class="sub-grid hidden">
            <div class="sub-card" data-label="office rent lease landlord tenancy" onclick="openFolder('Administration','office_rent')">Office Rent &amp; Lease</div>
            <div class="sub-card" data-label="utility bills water electricity gas" onclick="openFolder('Administration','utility_bills')">Utility Bills</div>
            <div class="sub-card" data-label="government correspondence letters" onclick="openFolder('Administration','govt_correspondence')">Government Correspondence</div>
            <div class="sub-card" data-label="approvals internal notes memos" onclick="openFolder('Administration','approvals')">Approvals &amp; Internal Notes</div>
            <div class="sub-card" data-label="company stamps documents" onclick="openFolder('Administration','stamps_documents')">Company Stamps / Documents</div>
            <div class="sub-card" data-label="travel ticketing flights" onclick="openFolder('Administration','travel_ticketing')">Travel &amp; Ticketing</div>
            <div class="sub-card" data-label="insurance" onclick="openFolder('Administration','insurance')">Insurance</div>
            <div class="sub-card" data-label="office inventory supplies" onclick="openFolder('Administration','office_inventory')">Office Inventory</div>
        </div>

        <!-- LEGAL & COMPLIANCE -->
        <div id="sub-LegalCompliance" class="sub-grid hidden">
            <div class="sub-card" data-label="trade license registration" onclick="openFolder('LegalCompliance','trade_license')">Trade License / Registration</div>
            <div class="sub-card" data-label="moa aoa share certificates" onclick="openFolder('LegalCompliance','moa_aoa')">MOA / AOA / Share Certificates</div>
            <div class="sub-card" data-label="contracts agreements" onclick="openFolder('LegalCompliance','contracts')">Contracts &amp; Agreements</div>
            <div class="sub-card" data-label="board resolutions" onclick="openFolder('LegalCompliance','board_resolutions')">Board Resolutions</div>
            <div class="sub-card" data-label="power of attorney" onclick="openFolder('LegalCompliance','power_of_attorney')">Power of Attorney</div>
            <div class="sub-card" data-label="vat returns sales tax" onclick="openFolder('LegalCompliance','vat_returns')">VAT Returns (UAE) / Sales Tax (PK)</div>
            <div class="sub-card" data-label="corporate tax files" onclick="openFolder('LegalCompliance','corporate_tax')">Corporate Tax Files</div>
            <div class="sub-card" data-label="fbr srb tax pakistan" onclick="openFolder('LegalCompliance','fbr_srb_tax')">FBR / Provincial Tax (Pakistan)</div>
            <div class="sub-card" data-label="legal notices" onclick="openFolder('LegalCompliance','legal_notices')">Legal Notices</div>
        </div>

        <!-- FINANCE & ACCOUNTING -->
        <div id="sub-FinanceAccounting" class="sub-grid hidden">
            <div class="sub-card" data-label="chart of accounts accounting coa" onclick="openFolder('FinanceAccounting','chart_of_accounts')">Chart of Accounts</div>

            <div class="sub-card" data-label="bank accounts uae bank" onclick="openFolder('FinanceAccounting','bank_accounts_UAE')">Bank Accounts – UAE Bank</div>
            <div class="sub-card" data-label="bank accounts pakistan bank" onclick="openFolder('FinanceAccounting','bank_accounts_PK')">Bank Accounts – Pakistan Bank</div>
            <div class="sub-card" data-label="bank reconciliations" onclick="openFolder('FinanceAccounting','bank_reconciliations')">Bank Accounts – Reconciliations</div>

            <div class="sub-card" data-label="cash petty cash uae" onclick="openFolder('FinanceAccounting','petty_cash_UAE')">Cash / Petty Cash – UAE</div>
            <div class="sub-card" data-label="cash petty cash pakistan" onclick="openFolder('FinanceAccounting','petty_cash_PK')">Cash / Petty Cash – Pakistan</div>

            <div class="sub-card" data-label="owners equity contributions" onclick="openFolder('FinanceAccounting','owners_equity_contributions')">Owners Equity – Contributions</div>
            <div class="sub-card" data-label="owners equity drawings" onclick="openFolder('FinanceAccounting','owners_equity_drawings')">Owners Equity – Drawings</div>

            <div class="sub-card" data-label="accounts receivable uae clients invoices acc" onclick="openFolder('FinanceAccounting','receivables_UAE_clients')">Accounts Receivable – UAE Clients</div>
            <div class="sub-card" data-label="accounts receivable pk clients invoices acc" onclick="openFolder('FinanceAccounting','receivables_PK_clients')">Accounts Receivable – PK Clients</div>

            <div class="sub-card" data-label="accounts payable uae vendors bills acc" onclick="openFolder('FinanceAccounting','payables_UAE_vendors')">Accounts Payable – UAE Vendors</div>
            <div class="sub-card" data-label="accounts payable pk vendors bills acc" onclick="openFolder('FinanceAccounting','payables_PK_vendors')">Accounts Payable – PK Vendors</div>

            <div class="sub-card" data-label="expense receipts uae" onclick="openFolder('FinanceAccounting','expenses_UAE')">Expense Receipts – UAE</div>
            <div class="sub-card" data-label="expense receipts pk" onclick="openFolder('FinanceAccounting','expenses_PK')">Expense Receipts – PK</div>

            <div class="sub-card" data-label="payroll salaries uae" onclick="openFolder('FinanceAccounting','payroll_UAE')">Payroll &amp; Salaries – UAE</div>
            <div class="sub-card" data-label="payroll salaries pk" onclick="openFolder('FinanceAccounting','payroll_PK')">Payroll &amp; Salaries – PK</div>

            <div class="sub-card" data-label="tax compliance" onclick="openFolder('FinanceAccounting','tax_compliance')">Tax &amp; Compliance</div>

            <div class="sub-card" data-label="financial reports monthly" onclick="openFolder('FinanceAccounting','reports_monthly')">Financial Reports – Monthly</div>
            <div class="sub-card" data-label="financial reports quarterly" onclick="openFolder('FinanceAccounting','reports_quarterly')">Financial Reports – Quarterly</div>
            <div class="sub-card" data-label="financial reports annual" onclick="openFolder('FinanceAccounting','reports_annual')">Financial Reports – Annual</div>

            <div class="sub-card" data-label="audits" onclick="openFolder('FinanceAccounting','audits')">Audits</div>
            <div class="sub-card" data-label="fixed assets register" onclick="openFolder('FinanceAccounting','fixed_assets_register')">Fixed Assets Register</div>
        </div>

        <!-- PROCUREMENT -->
        <div id="sub-Procurement" class="sub-grid hidden">
            <!-- BASIC SET (you can add more entries here to match your PowerShell structure) -->
            <div class="sub-card" data-label="procurement policies" onclick="openFolder('Procurement','policies')">Procurement Policies</div>
            <div class="sub-card" data-label="purchase requisitions pr" onclick="openFolder('Procurement','PR')">Purchase Requisitions (PR)</div>
            <div class="sub-card" data-label="rfq requests for quotation" onclick="openFolder('Procurement','RFQ')">RFQs (Requests for Quotation)</div>
            <div class="sub-card" data-label="supplier quotations quotes" onclick="openFolder('Procurement','quotations')">Supplier Quotations</div>
            <div class="sub-card" data-label="purchase orders po" onclick="openFolder('Procurement','PO')">Purchase Orders (PO)</div>
            <div class="sub-card" data-label="vendor database vendors" onclick="openFolder('Procurement','vendors')">Vendor Database</div>
            <div class="sub-card" data-label="supplier evaluations" onclick="openFolder('Procurement','evaluations')">Supplier Evaluations</div>
            <div class="sub-card" data-label="goods received notes grn" onclick="openFolder('Procurement','GRN')">Goods Received Notes (GRN)</div>
            <div class="sub-card" data-label="delivery challans" onclick="openFolder('Procurement','challans')">Delivery Challans</div>
            <div class="sub-card" data-label="import documents" onclick="openFolder('Procurement','import_documents')">Import Documents</div>

            <!-- EXAMPLE EXTRA GROUPS – match these keys with your PowerShell tree if needed -->
            <!--
            <div class="sub-card" onclick="openFolder('Procurement','suppliers_master')">Suppliers Master</div>
            <div class="sub-card" onclick="openFolder('Procurement','local_procurement')">Local Procurement</div>
            <div class="sub-card" onclick="openFolder('Procurement','import_procurement')">Import Procurement</div>
            <div class="sub-card" onclick="openFolder('Procurement','uae_suppliers')">UAE Suppliers</div>
            <div class="sub-card" onclick="openFolder('Procurement','pk_suppliers')">Pakistan Suppliers</div>
            -->
        </div>

        <!-- OPERATIONS -->
        <div id="sub-Operations" class="sub-grid hidden">
            <div class="sub-card" data-label="sops standard operating procedures" onclick="openFolder('Operations','SOPs')">SOPs (Standard Operating Procedures)</div>
            <div class="sub-card" data-label="workflows process maps" onclick="openFolder('Operations','workflows')">Workflows</div>
            <div class="sub-card" data-label="daily weekly monthly reports" onclick="openFolder('Operations','reports')">Daily / Weekly / Monthly Reports</div>
            <div class="sub-card" data-label="project coordination" onclick="openFolder('Operations','coordination')">Project Coordination</div>
            <div class="sub-card" data-label="machinery equipment logs" onclick="openFolder('Operations','equipment_logs')">Machinery &amp; Equipment Logs</div>
            <div class="sub-card" data-label="maintenance logs" onclick="openFolder('Operations','maintenance_logs')">Maintenance Logs</div>
            <div class="sub-card" data-label="operations planning" onclick="openFolder('Operations','planning')">Operations Planning</div>
        </div>

        <!-- SALES & MARKETING -->
        <div id="sub-SalesMarketing" class="sub-grid hidden">
            <div class="sub-card" data-label="sales pipeline deals" onclick="openFolder('SalesMarketing','pipeline')">Sales Pipeline</div>
            <div class="sub-card" data-label="client profiles customers" onclick="openFolder('SalesMarketing','profiles')">Client Profiles</div>
            <div class="sub-card" data-label="proposals presentations offers" onclick="openFolder('SalesMarketing','proposals')">Proposals &amp; Presentations</div>
            <div class="sub-card" data-label="marketing material brochures" onclick="openFolder('SalesMarketing','marketing')">Marketing Material</div>
            <div class="sub-card" data-label="social media content" onclick="openFolder('SalesMarketing','social_media')">Social Media Content</div>
            <div class="sub-card" data-label="campaigns performance" onclick="openFolder('SalesMarketing','campaigns')">Campaigns &amp; Performance</div>
            <div class="sub-card" data-label="crm data customers" onclick="openFolder('SalesMarketing','CRM')">CRM Data</div>
            <div class="sub-card" data-label="pricing strategies price" onclick="openFolder('SalesMarketing','pricing')">Pricing &amp; Strategies</div>
        </div>

        <!-- HR -->
        <div id="sub-HR" class="sub-grid hidden">
            <div class="sub-card" data-label="employee files uae staff" onclick="openFolder('HR','employee_files_UAE')">Employee Files – UAE Staff</div>
            <div class="sub-card" data-label="employee files pk staff" onclick="openFolder('HR','employee_files_PK')">Employee Files – Pakistan Staff</div>
            <div class="sub-card" data-label="contracts" onclick="openFolder('HR','contracts')">Contracts</div>
            <div class="sub-card" data-label="attendance timesheets" onclick="openFolder('HR','attendance')">Attendance &amp; Timesheets</div>
            <div class="sub-card" data-label="payroll records" onclick="openFolder('HR','payroll_records')">Payroll Records</div>
            <div class="sub-card" data-label="visas immigration uae" onclick="openFolder('HR','visas')">Visas &amp; Immigration (UAE)</div>
            <div class="sub-card" data-label="training development" onclick="openFolder('HR','training')">Training &amp; Development</div>
            <div class="sub-card" data-label="hr policies" onclick="openFolder('HR','policies')">HR Policies</div>
            <div class="sub-card" data-label="disciplinary actions" onclick="openFolder('HR','disciplinary')">Disciplinary Actions</div>
        </div>

        <!-- PROJECTS -->
        <div id="sub-Projects" class="sub-grid hidden">
            <div class="sub-card" data-label="project 001" onclick="openFolder('Projects','project_001')">Project 001 – Name</div>
            <div class="sub-card" data-label="project 002" onclick="openFolder('Projects','project_002')">Project 002 – Name</div>
            <div class="sub-card" data-label="boqs" onclick="openFolder('Projects','BOQs')">BOQs</div>
            <div class="sub-card" data-label="quotations" onclick="openFolder('Projects','quotations')">Quotations</div>
            <div class="sub-card" data-label="project budgets" onclick="openFolder('Projects','budgets')">Project Budgets</div>
            <div class="sub-card" data-label="drawings" onclick="openFolder('Projects','drawings')">Drawings</div>
            <div class="sub-card" data-label="reports" onclick="openFolder('Projects','reports')">Reports</div>
            <div class="sub-card" data-label="project invoices" onclick="openFolder('Projects','invoices')">Project Invoices</div>
            <div class="sub-card" data-label="tracking sheets" onclick="openFolder('Projects','tracking')">Tracking Sheets</div>
        </div>

        <!-- IT & SYSTEMS -->
        <div id="sub-ITSystems" class="sub-grid hidden">
            <div class="sub-card" data-label="software licenses" onclick="openFolder('ITSystems','licenses')">Software Licenses</div>
            <div class="sub-card" data-label="usernames passwords records" onclick="openFolder('ITSystems','passwords')">Usernames &amp; Password Records (Encrypted)</div>
            <div class="sub-card" data-label="system policies" onclick="openFolder('ITSystems','policies')">System Policies</div>
            <div class="sub-card" data-label="hardware inventory" onclick="openFolder('ITSystems','hardware')">Hardware Inventory</div>
            <div class="sub-card" data-label="it support tickets" onclick="openFolder('ITSystems','tickets')">IT Support Tickets</div>
        </div>

        <!-- ASSETS & INVENTORY -->
        <div id="sub-AssetsInventory" class="sub-grid hidden">
            <div class="sub-card" data-label="movable assets furniture computers" onclick="openFolder('AssetsInventory','furniture')">Movable Assets (Furniture, Computers)</div>
            <div class="sub-card" data-label="vehicles" onclick="openFolder('AssetsInventory','vehicles')">Vehicles</div>
            <div class="sub-card" data-label="office equipment" onclick="openFolder('AssetsInventory','equipment')">Office Equipment</div>
            <div class="sub-card" data-label="inventory records" onclick="openFolder('AssetsInventory','inventory')">Inventory Records</div>
            <div class="sub-card" data-label="depreciation files" onclick="openFolder('AssetsInventory','depreciation')">Depreciation Files</div>
        </div>

        <!-- INTERCOMPANY -->
        <div id="sub-Intercompany" class="sub-grid hidden">
            <div class="sub-card" data-label="transfer pricing agreements" onclick="openFolder('Intercompany','transfer_pricing')">Transfer Pricing Agreements</div>
            <div class="sub-card" data-label="intercompany loan agreements" onclick="openFolder('Intercompany','loans')">Intercompany Loan Agreements</div>
            <div class="sub-card" data-label="uae to pk transfers" onclick="openFolder('Intercompany','transfers_uae_to_pk')">UAE to PK Transfers</div>
            <div class="sub-card" data-label="pk to uae settlements" onclick="openFolder('Intercompany','transfers_pk_to_uae')">PK to UAE Settlements</div>
            <div class="sub-card" data-label="monthly reconciliation" onclick="openFolder('Intercompany','reconciliation')">Monthly Reconciliation</div>
            <div class="sub-card" data-label="profit repatriation files" onclick="openFolder('Intercompany','profit_repatriation')">Profit Repatriation Files</div>
        </div>

        <!-- DIRECTORS & OWNERSHIP -->
        <div id="sub-DirectorsOwnership" class="sub-grid hidden">
            <div class="sub-card" data-label="shareholding structure partners" onclick="openFolder('DirectorsOwnership','structure')">Shareholding Structure</div>
            <div class="sub-card" data-label="investor agreements" onclick="openFolder('DirectorsOwnership','agreements')">Investor Agreements</div>
            <div class="sub-card" data-label="strategic planning strategy" onclick="openFolder('DirectorsOwnership','strategy')">Strategic Planning</div>
            <div class="sub-card" data-label="business plans" onclick="openFolder('DirectorsOwnership','business_plans')">Business Plans</div>
            <div class="sub-card" data-label="profit distribution dividends" onclick="openFolder('DirectorsOwnership','profit_distribution')">Profit Distribution</div>
        </div>

        <!-- R&D -->
        <div id="sub-RnD" class="sub-grid hidden">
            <div class="sub-card" data-label="market research" onclick="openFolder('RnD','research')">Market Research</div>
            <div class="sub-card" data-label="competitor analysis" onclick="openFolder('RnD','competitors')">Competitor Analysis</div>
            <div class="sub-card" data-label="new product ideas" onclick="openFolder('RnD','ideas')">New Product Ideas</div>
            <div class="sub-card" data-label="product development" onclick="openFolder('RnD','development')">Product Development</div>
            <div class="sub-card" data-label="technical specifications" onclick="openFolder('RnD','specifications')">Technical Specifications</div>
            <div class="sub-card" data-label="testing quality assurance" onclick="openFolder('RnD','testing')">Testing &amp; Quality Assurance</div>
            <div class="sub-card" data-label="samples trials" onclick="openFolder('RnD','samples')">Samples &amp; Trials</div>
            <div class="sub-card" data-label="reports findings" onclick="openFolder('RnD','reports')">Reports &amp; Findings</div>
            <div class="sub-card" data-label="feasibility studies" onclick="openFolder('RnD','feasibility')">Feasibility Studies</div>
            <div class="sub-card" data-label="r&d budget costing" onclick="openFolder('RnD','budget')">R&amp;D Budget &amp; Costing</div>
            <div class="sub-card" data-label="intellectual property patents trademarks" onclick="openFolder('RnD','IP')">Intellectual Property (Patents, Trademarks)</div>
        </div>

        <!-- PRODUCT HUNTING & SOURCING -->
        <div id="sub-ProductSourcing" class="sub-grid hidden">
            <div class="sub-card" data-label="china supplier list" onclick="openFolder('ProductSourcing','China_supplier_list')">China – Supplier List</div>
            <div class="sub-card" data-label="china vendors alibaba globalsources" onclick="openFolder('ProductSourcing','China_vendors')">China – Alibaba / Globalsources Vendors</div>
            <div class="sub-card" data-label="china product options" onclick="openFolder('ProductSourcing','China_product_options')">China – Product Options</div>
            <div class="sub-card" data-label="china quotations quotes" onclick="openFolder('ProductSourcing','China_quotations')">China – Quotations</div>
            <div class="sub-card" data-label="china negotiations chats" onclick="openFolder('ProductSourcing','China_chats')">China – Negotiations &amp; Chats</div>
            <div class="sub-card" data-label="china samples ordered" onclick="openFolder('ProductSourcing','China_samples')">China – Samples Ordered</div>
            <div class="sub-card" data-label="china sample reports" onclick="openFolder('ProductSourcing','China_sample_reports')">China – Sample Reports</div>
            <div class="sub-card" data-label="china factory audit reports" onclick="openFolder('ProductSourcing','China_audits')">China – Factory Audit Reports</div>
            <div class="sub-card" data-label="china shipping logistics" onclick="openFolder('ProductSourcing','China_logistics')">China – Shipping &amp; Logistics</div>
            <div class="sub-card" data-label="china costs pricing" onclick="openFolder('ProductSourcing','China_costs_pricing')">China – Costs &amp; Pricing</div>

            <div class="sub-card" data-label="usa supplier list" onclick="openFolder('ProductSourcing','USA_supplier_list')">USA – Supplier List</div>
            <div class="sub-card" data-label="usa product options" onclick="openFolder('ProductSourcing','USA_product_options')">USA – Product Options</div>
            <div class="sub-card" data-label="usa quotations" onclick="openFolder('ProductSourcing','USA_quotations')">USA – Quotations</div>
            <div class="sub-card" data-label="usa samples" onclick="openFolder('ProductSourcing','USA_samples')">USA – Samples</div>
            <div class="sub-card" data-label="usa discussions emails" onclick="openFolder('ProductSourcing','USA_discussions_emails')">USA – Discussions / Emails</div>

            <div class="sub-card" data-label="uae manufacturers" onclick="openFolder('ProductSourcing','Other_UAE_manufacturers')">Other – UAE Manufacturers</div>
            <div class="sub-card" data-label="turkey" onclick="openFolder('ProductSourcing','Other_Turkey')">Other – Turkey</div>
            <div class="sub-card" data-label="europe" onclick="openFolder('ProductSourcing','Other_Europe')">Other – Europe</div>
            <div class="sub-card" data-label="pakistan local suppliers" onclick="openFolder('ProductSourcing','Other_PK_local_suppliers')">Other – Pakistan Local Suppliers</div>

            <div class="sub-card" data-label="product comparison sheets" onclick="openFolder('ProductSourcing','comparison_sheets')">Product Comparison Sheets</div>
            <div class="sub-card" data-label="shortlisted products" onclick="openFolder('ProductSourcing','shortlisted_products')">Shortlisted Products</div>
            <div class="sub-card" data-label="costing profit analysis" onclick="openFolder('ProductSourcing','costing_profit_analysis')">Costing &amp; Profit Analysis</div>
            <div class="sub-card" data-label="supplier performance tracking" onclick="openFolder('ProductSourcing','supplier_performance')">Supplier Performance Tracking</div>
            <div class="sub-card" data-label="import documents" onclick="openFolder('ProductSourcing','import_documents')">Import Documents</div>
            <div class="sub-card" data-label="purchase plan" onclick="openFolder('ProductSourcing','purchase_plan')">Purchase Plan</div>
        </div>

        <!-- ARCHIVE -->
        <div id="sub-Archive" class="sub-grid hidden">
            <div class="sub-card" data-label="old contracts" onclick="openFolder('Archive','old_contracts')">Old Contracts</div>
            <div class="sub-card" data-label="former employees" onclick="openFolder('Archive','former_employees')">Former Employees</div>
            <div class="sub-card" data-label="closed projects" onclick="openFolder('Archive','closed_projects')">Closed Projects</div>
            <div class="sub-card" data-label="old bank statements" onclick="openFolder('Archive','old_bank_statements')">Old Bank Statements</div>
            <div class="sub-card" data-label="previous year accounting" onclick="openFolder('Archive','previous_accounting')">Previous Year Accounting</div>
        </div>

    </div>

</div>
</div>
</div>

<script>
/* ============================
   SIMPLE LOCAL LOGIN USERS
   ============================ */
const USERS = {
    "shuja":    { password: "AT25UAE", displayName: "Shuja" },
    "saif":     { password: "AT25UAE", displayName: "Saif" },
    "mushafaq": { password: "AT25UAE", displayName: "Mushafaq" },
    "shahab":   { password: "AT25UAE", displayName: "Shahab" }
};

/* ============================
   GLOBAL STATE
   ============================ */
let currentUser = null;
let currentCompanyCode = "UAE";  // "UAE" or "PK"
let currentCompanyLabel = "Agrotech UAE";
let currentDeptKey = null;

// JSON with OneDrive links (loaded from agrotech-links.json)
let CLOUD_LINKS = null;

/* ============================
   LOAD JSON ON PAGE LOAD
   ============================ */
window.addEventListener("load", () => {
    // Clear login fields
    document.getElementById("login-username").value = "";
    document.getElementById("login-password").value = "";

    // Load cloud links
    fetch("agrotech-links.json")
        .then(r => r.json())
        .then(json => {
            CLOUD_LINKS = json;
            console.log("CLOUD_LINKS loaded:", CLOUD_LINKS);
        })
        .catch(err => {
            console.error("Error loading agrotech-links.json", err);
        });
});

/* ============================
   LOGIN LOGIC (LOCAL ONLY)
   ============================ */
function handleLogin() {
    const rawUser = document.getElementById("login-username").value.trim();
    const u = rawUser.toLowerCase();
    const p = document.getElementById("login-password").value;
    const errorEl = document.getElementById("login-error");

    if (!USERS[u] || USERS[u].password !== p) {
        errorEl.textContent = "Invalid username or password.";
        return;
    }

    currentUser = { username: u, displayName: USERS[u].displayName };
    document.getElementById("user-label").textContent = currentUser.displayName;
    errorEl.textContent = "";

    // Hide login overlay
    const loginScreen = document.getElementById("screen-login");
    loginScreen.style.display = "none";

    // Show topbar + main content
    document.getElementById("topbar").classList.remove("hidden");
    document.getElementById("main-content").classList.remove("hidden");

    // Reset entity to UAE by default
    currentCompanyCode = "UAE";
    currentCompanyLabel = "Agrotech UAE";
    document.getElementById("btn-uae").classList.add("active");
    document.getElementById("btn-pk").classList.remove("active");

    goToMainMenu();
}

/* ============================
   LOGOUT
   ============================ */
function handleLogout() {
    currentUser = null;
    currentCompanyCode = "UAE";
    currentCompanyLabel = "Agrotech UAE";
    currentDeptKey = null;

    const loginScreen = document.getElementById("screen-login");
    loginScreen.style.display = "flex"; // restore overlay

    document.getElementById("topbar").classList.add("hidden");
    document.getElementById("main-content").classList.add("hidden");

    document.getElementById("login-username").value = "";
    document.getElementById("login-password").value = "";
    document.getElementById("login-error").textContent = "";
    window.scrollTo(0, 0);
}

/* ============================
   MAIN MENU
   ============================ */
function goToMainMenu() {
    currentDeptKey = null;
    document.getElementById("searchBox").value = "";

    // Show Select Entity screen
    document.getElementById("screen-companies").classList.remove("hidden");
    document.getElementById("screen-departments").classList.add("hidden");
    document.getElementById("screen-sub").classList.add("hidden");

    // Show group logo
    changeMainLogo(null);

    window.scrollTo(0, 0);
}

/* ============================
   UI HELPERS
   ============================ */
function showOnly(id) {
    ["screen-companies", "screen-departments", "screen-sub"].forEach(s => {
        document.getElementById(s).classList.add("hidden");
    });
    document.getElementById(id).classList.remove("hidden");
}

function changeMainLogo(code) {
    const logo = document.getElementById("main-logo");
    if (code === "UAE") {
        logo.src = "images/agrotech_uae.png";
    } else if (code === "PK") {
        logo.src = "images/agrotech_pakistan.png";
    } else {
        logo.src = "images/company_logo.png";
    }
}

/* ============================
   ENTITY SWITCHING
   ============================ */
function switchEntity(code) {
    currentCompanyCode = code;
    currentCompanyLabel = (code === "UAE") ? "Agrotech UAE" : "Agrotech Pakistan";

    document.getElementById("btn-uae").classList.toggle("active", code === "UAE");
    document.getElementById("btn-pk").classList.toggle("active", code === "PK");

    if (document.getElementById("screen-companies").classList.contains("hidden")) {
        // departments or sub screen
        changeMainLogo(code);
    } else {
        // selecting entity
        changeMainLogo(null);
    }

    if (currentDeptKey) {
        const title = document.getElementById("sub-title").innerText;
        document.getElementById("sub-breadcrumb").innerText =
            "Entity: " + currentCompanyLabel + "  ›  " + title;
    } else {
        document.getElementById("dept-breadcrumb").innerText =
            "Entity: " + currentCompanyLabel;
    }
}

/* entity cards click */
function openDepartments(entityCode) {
    switchEntity(entityCode);
    document.getElementById("dept-breadcrumb").innerText =
        "Entity: " + currentCompanyLabel;

    currentDeptKey = null;
    document.getElementById("searchBox").value = "";
    showOnly("screen-departments");
}

/* back buttons */
function goBackToCompanies() {
    currentDeptKey = null;
    document.getElementById("searchBox").value = "";
    changeMainLogo(null);
    showOnly("screen-companies");
}

function goBackToDepartments() {
    document.querySelectorAll(".sub-grid").forEach(g => g.classList.add("hidden"));
    currentDeptKey = null;
    document.getElementById("searchBox").value = "";
    showOnly("screen-departments");
}

/* ============================
   OPEN DEPARTMENT SUBFOLDERS
   ============================ */
function openSub(deptKey) {
    document.querySelectorAll(".sub-grid").forEach(g => g.classList.add("hidden"));

    const titles = {
        "Administration": "Administration",
        "LegalCompliance": "Legal & Compliance",
        "FinanceAccounting": "Finance & Accounting",
        "Procurement": "Procurement",
        "Operations": "Operations",
        "SalesMarketing": "Sales & Marketing",
        "HR": "Human Resources (HR)",
        "Projects": "Projects",
        "ITSystems": "IT & Systems",
        "AssetsInventory": "Assets & Inventory",
        "Intercompany": "Intercompany (UAE ↔ Pakistan)",
        "DirectorsOwnership": "Directors & Ownership",
        "RnD": "Research & Development (R&D)",
        "ProductSourcing": "Product Hunting & Sourcing",
        "Archive": "Archive (Old / Closed Files)"
    };

    currentDeptKey = deptKey;

    const title = titles[deptKey] || "";
    document.getElementById("sub-title").innerText = title;
    document.getElementById("sub-breadcrumb").innerText =
        "Entity: " + currentCompanyLabel + "  ›  " + title;

    const grid = document.getElementById("sub-" + deptKey);
    if (grid) grid.classList.remove("hidden");

    showOnly("screen-sub");
}

/* ============================
   PURE CLOUD FOLDER OPEN
   using agrotech-links.json
   ============================ */
function openFolder(deptKey, folderPath) {
    if (!currentCompanyCode) {
        alert("Please select an entity first.");
        return;
    }
    if (!CLOUD_LINKS) {
        alert("Cloud links not loaded yet. Please wait a moment and try again.");
        return;
    }

    // Entity key in JSON
    const entityKey = (currentCompanyCode === "UAE") ? "Agrotech_UAE" : "Agrotech_PK";
    const entityObj = CLOUD_LINKS[entityKey];

    if (!entityObj) {
        alert("No cloud links found for entity: " + entityKey);
        return;
    }

    const deptObj = entityObj[deptKey];
    if (!deptObj) {
        alert("No cloud links found for department: " + deptKey);
        return;
    }

    // JSON uses keys like "China\\supplier_list" while HTML passes "China/supplier_list"
    const keySlash = folderPath;                       // e.g. "China/supplier_list"
    const keyBackslash = folderPath.replace(/\//g, "\\"); // e.g. "China\supplier_list"

    const url = deptObj[keyBackslash] || deptObj[keySlash];

    if (!url) {
        alert("No cloud link defined for: " + deptKey + " / " + folderPath);
        console.log("Missing link for", entityKey, deptKey, folderPath, "tried", keyBackslash, keySlash);
        return;
    }

    // Open exact OneDrive folder in new tab
    window.open(url, "_blank");
}

/* ============================
   SEARCH SYSTEM
   ============================ */
function handleSearch(query) {
    const q = query.trim().toLowerCase();

    const deptScreen = !document.getElementById("screen-departments").classList.contains("hidden");
    const subScreen  = !document.getElementById("screen-sub").classList.contains("hidden");

    if (deptScreen) {
        const cards = document.querySelectorAll("#dept-grid .card");
        cards.forEach(card => {
            const text = (card.getAttribute("data-label") || card.innerText || "").toLowerCase();
            card.style.display = text.includes(q) ? "" : "none";
        });
    }

    if (subScreen) {
        const activeSubGrid = document.querySelector("#screen-sub .sub-grid:not(.hidden)");
        if (!activeSubGrid) return;
        const subCards = activeSubGrid.querySelectorAll(".sub-card");
        subCards.forEach(card => {
            const text = (card.getAttribute("data-label") || card.innerText || "").toLowerCase();
            card.style.display = text.includes(q) ? "" : "none";
        });
    }
}
</script>

<script>
//////////////////////////////
// MICROSOFT ONEDRIVE LOGIN //
//////////////////////////////

const msalConfig = {
    auth: {
        clientId: "5843a531-be22-4d2c-8edd-5163320c34ad",
        authority: "https://login.microsoftonline.com/50930755-e12d-4846-92c0-327410e12875",
        redirectUri: "https://agrotechpk.github.io/AGROTECH-INTERFACE/"
    }
};

const loginRequest = {
    scopes: [
        "Files.ReadWrite",
        "Files.ReadWrite.All",
        "Sites.ReadWrite.All",
        "offline_access"
    ]
};

const msalApp = new msal.PublicClientApplication(msalConfig);

async function loginToOneDrive() {
    try {
        const result = await msalApp.loginPopup(loginRequest);
        console.log("OneDrive Login Success:", result);
        sessionStorage.setItem("onedriveToken", result.accessToken);
    } catch (err) {
        console.error("OneDrive Login Failed:", err);
    }
}

///////////////////////////////////////
// SIMPLE USER DB
///////////////////////////////////////

const USERS = {
    "shuja":    { password: "AT25UAE", displayName: "Shuja" },
    "saif":     { password: "AT25UAE", displayName: "Saif" },
    "mushafaq": { password: "AT25UAE", displayName: "Mushafaq" },
    "shahab":   { password: "AT25UAE", displayName: "Shahab" }
};

///////////////////////////////////////
// GLOBAL STATE
///////////////////////////////////////
let currentUser = null;
let currentCompanyCode = "UAE";  // "UAE" or "PK"
let currentCompanyLabel = "Agrotech UAE";
let currentDeptKey = null;

///////////////////////////////////////
// ENTITY ROOT LINKS (fallback)
///////////////////////////////////////
const ENTITY_ROOT = {
    UAE: "https://1drv.ms/f/c/9b43ceb10aebca25/IgB0uCk1FBRHSJ8mNWt1U0SEAeOEaMDvuNkk4fC6oDeeA28?e=UZ0iPF",
    PK:  "https://1drv.ms/f/c/9b43ceb10aebca25/IgDQDUN3RFo2TJbHPEH4DlquAdfEgTeZU02-m3SDWU6sFWI?e=zbZ3yT"
};

///////////////////////////////////////
// PER-FOLDER CLOUD LINKS
// NOTE: Fill these with your REAL OneDrive "anyone can edit" links.
// If a link is missing, the code will open ENTITY_ROOT[UAE/PK] instead.
///////////////////////////////////////
const CLOUD_LINKS = {
    UAE: {
        Administration: {
            office_rent:        "", // paste OneDrive link for UAE Administration/office_rent
            utility_bills:      "",
            govt_correspondence:"",
            approvals:          "",
            stamps_documents:   "",
            travel_ticketing:   "",
            insurance:          "",
            office_inventory:   ""
        },
        LegalCompliance: {
            trade_license:   "",
            moa_aoa:         "",
            contracts:       "",
            board_resolutions:"",
            power_of_attorney:"",
            vat_returns:     "",
            corporate_tax:   "",
            fbr_srb_tax:     "",
            legal_notices:   ""
        },
        FinanceAccounting: {
            chart_of_accounts:          "",
            bank_accounts_UAE:          "",
            bank_accounts_PK:           "",
            bank_reconciliations:       "",
            petty_cash_UAE:             "",
            petty_cash_PK:              "",
            owners_equity_contributions:"",
            owners_equity_drawings:     "",
            receivables_UAE_clients:    "",
            receivables_PK_clients:     "",
            payables_UAE_vendors:       "",
            payables_PK_vendors:        "",
            expenses_UAE:               "",
            expenses_PK:                "",
            payroll_UAE:                "",
            payroll_PK:                 "",
            tax_compliance:             "",
            reports_monthly:            "",
            reports_quarterly:          "",
            reports_annual:             "",
            audits:                     "",
            fixed_assets_register:      ""
        },
        Procurement: {
            policies:          "",
            PR:                "",
            RFQ:               "",
            quotations:        "",
            PO:                "",
            vendors:           "",
            evaluations:       "",
            GRN:               "",
            challans:          "",
            import_documents:  ""
            // extra keys you add in HTML go here as well
        }
        // ...add other departments for UAE if you want per-folder control
    },
    PK: {
        Administration: {
            office_rent:        "",
            utility_bills:      "",
            govt_correspondence:"",
            approvals:          "",
            stamps_documents:   "",
            travel_ticketing:   "",
            insurance:          "",
            office_inventory:   ""
        },
        LegalCompliance: {
            trade_license:   "",
            moa_aoa:         "",
            contracts:       "",
            board_resolutions:"",
            power_of_attorney:"",
            vat_returns:     "",
            corporate_tax:   "",
            fbr_srb_tax:     "",
            legal_notices:   ""
        },
        FinanceAccounting: {
            chart_of_accounts:          "",
            bank_accounts_UAE:          "",
            bank_accounts_PK:           "",
            bank_reconciliations:       "",
            petty_cash_UAE:             "",
            petty_cash_PK:              "",
            owners_equity_contributions:"",
            owners_equity_drawings:     "",
            receivables_UAE_clients:    "",
            receivables_PK_clients:     "",
            payables_UAE_vendors:       "",
            payables_PK_vendors:        "",
            expenses_UAE:               "",
            expenses_PK:                "",
            payroll_UAE:                "",
            payroll_PK:                 "",
            tax_compliance:             "",
            reports_monthly:            "",
            reports_quarterly:          "",
            reports_annual:             "",
            audits:                     "",
            fixed_assets_register:      ""
        },
        Procurement: {
            policies:          "",
            PR:                "",
            RFQ:               "",
            quotations:        "",
            PO:                "",
            vendors:           "",
            evaluations:       "",
            GRN:               "",
            challans:          "",
            import_documents:  ""
        }
        // ...add other departments for PK similarly
    }
};

///////////////////////////////////////
// LOGIN LOGIC
///////////////////////////////////////
async function handleLogin() {
    const rawUser = document.getElementById("login-username").value.trim();
    const u = rawUser.toLowerCase();
    const p = document.getElementById("login-password").value;
    const errorEl = document.getElementById("login-error");

    if (!USERS[u] || USERS[u].password !== p) {
        errorEl.textContent = "Invalid username or password.";
        return;
    }

    // LOCAL LOGIN SUCCESS
    currentUser = { username: u, displayName: USERS[u].displayName };
    document.getElementById("user-label").textContent = currentUser.displayName;
    errorEl.textContent = "";

    // OPTIONAL: OneDrive login (you already gave 'anyone can edit' links,
    // so this is mainly for future Graph integration)
    try {
        await loginToOneDrive();
        console.log("OneDrive Auth Complete");
    } catch (e) {
        console.error("OneDrive login skipped / failed:", e);
    }

    // HIDE LOGIN SCREEN
    document.getElementById("screen-login").style.display = "none";

    // SHOW TOPBAR + MAIN CONTENT
    document.getElementById("topbar").classList.remove("hidden");
    document.getElementById("main-content").classList.remove("hidden");

    // DIRECT TO ENTITY PAGE
    document.getElementById("screen-companies").classList.remove("hidden");
    document.getElementById("screen-departments").classList.add("hidden");
    document.getElementById("screen-sub").classList.add("hidden");

    changeMainLogo(null);
    window.scrollTo(0, 0);

    goToMainMenu();
}

/* logout */
function handleLogout() {
    currentUser = null;
    currentCompanyCode = "UAE";
    currentCompanyLabel = "Agrotech UAE";
    currentDeptKey = null;

    // SHOW LOGIN OVERLAY AGAIN
    document.getElementById("screen-login").style.display = "flex";

    document.getElementById("topbar").classList.add("hidden");
    document.getElementById("main-content").classList.add("hidden");

    document.getElementById("login-username").value = "";
    document.getElementById("login-password").value = "";
    document.getElementById("login-error").textContent = "";
    window.scrollTo(0, 0);
}

/* go to main menu from topbar */
function goToMainMenu() {
    currentDeptKey = null;
    document.getElementById("searchBox").value = "";

    // Show Select Entity screen properly
    document.getElementById("screen-companies").classList.remove("hidden");
    document.getElementById("screen-departments").classList.add("hidden");
    document.getElementById("screen-sub").classList.add("hidden");

    // Show the main big group logo
    changeMainLogo(null);

    window.scrollTo(0, 0);
}

/* ====== UI HELPER ====== */
function showOnly(id) {
    ["screen-companies","screen-departments","screen-sub"].forEach(s => {
        document.getElementById(s).classList.add("hidden");
    });
    document.getElementById(id).classList.remove("hidden");
}

function changeMainLogo(code) {
    const logo = document.getElementById("main-logo");
    if (code === "UAE") {
        logo.src = "images/agrotech_uae.png";
    } else if (code === "PK") {
        logo.src = "images/agrotech_pakistan.png";
    } else {
        logo.src = "images/company_logo.png";
    }
}

/* ====== ENTITY SWITCHING ====== */
function switchEntity(code) {
    currentCompanyCode = code;
    currentCompanyLabel = (code === "UAE") ? "Agrotech UAE" : "Agrotech Pakistan";

    document.getElementById("btn-uae").classList.toggle("active", code === "UAE");
    document.getElementById("btn-pk").classList.toggle("active", code === "PK");

    if (document.getElementById("screen-companies").classList.contains("hidden")) {
        changeMainLogo(code);
    } else {
        changeMainLogo(null);
    }

    if (currentDeptKey) {
        const title = document.getElementById("sub-title").innerText;
        document.getElementById("sub-breadcrumb").innerText =
            "Entity: " + currentCompanyLabel + "  ›  " + title;
    } else {
        document.getElementById("dept-breadcrumb").innerText =
            "Entity: " + currentCompanyLabel;
    }
}

/* from entity cards */
function openDepartments(entityCode) {
    switchEntity(entityCode);
    document.getElementById("dept-breadcrumb").innerText =
        "Entity: " + currentCompanyLabel;

    currentDeptKey = null;
    document.getElementById("searchBox").value = "";
    showOnly("screen-departments");
}

/* back to companies */
function goBackToCompanies() {
    currentDeptKey = null;
    document.getElementById("searchBox").value = "";
    changeMainLogo(null);
    showOnly("screen-companies");
}

/* back from sub to departments */
function goBackToDepartments() {
    document.querySelectorAll(".sub-grid").forEach(g => g.classList.add("hidden"));
    currentDeptKey = null;
    document.getElementById("searchBox").value = "";
    showOnly("screen-departments");
}

/* open department's subfolders */
function openSub(deptKey) {
    document.querySelectorAll(".sub-grid").forEach(g => g.classList.add("hidden"));

    const titles = {
        "Administration": "Administration",
        "LegalCompliance": "Legal & Compliance",
        "FinanceAccounting": "Finance & Accounting",
        "Procurement": "Procurement",
        "Operations": "Operations",
        "SalesMarketing": "Sales & Marketing",
        "HR": "Human Resources (HR)",
        "Projects": "Projects",
        "ITSystems": "IT & Systems",
        "AssetsInventory": "Assets & Inventory",
        "Intercompany": "Intercompany (UAE ↔ Pakistan)",
        "DirectorsOwnership": "Directors & Ownership",
        "RnD": "Research & Development (R&D)",
        "ProductSourcing": "Product Hunting & Sourcing",
        "Archive": "Archive (Old / Closed Files)"
    };

    currentDeptKey = deptKey;

    const title = titles[deptKey] || "";
    document.getElementById("sub-title").innerText = title;
    document.getElementById("sub-breadcrumb").innerText =
        "Entity: " + currentCompanyLabel + "  ›  " + title;

    const grid = document.getElementById("sub-" + deptKey);
    if (grid) grid.classList.remove("hidden");

    showOnly("screen-sub");
}

/* open folder path in OneDrive (CLOUD ONLY) */

/* ====== SEARCH SYSTEM ====== */
function handleSearch(query) {
    const q = query.trim().toLowerCase();

    const deptScreen = !document.getElementById("screen-departments").classList.contains("hidden");
    const subScreen  = !document.getElementById("screen-sub").classList.contains("hidden");

    if (deptScreen) {
        const cards = document.querySelectorAll("#dept-grid .card");
        cards.forEach(card => {
            const text = (card.getAttribute("data-label") || card.innerText || "").toLowerCase();
            card.style.display = text.includes(q) ? "" : "none";
        });
    }

    if (subScreen) {
        const activeSubGrid = document.querySelector("#screen-sub .sub-grid:not(.hidden)");
        if (!activeSubGrid) return;
        const subCards = activeSubGrid.querySelectorAll(".sub-card");
        subCards.forEach(card => {
            const text = (card.getAttribute("data-label") || card.innerText || "").toLowerCase();
            card.style.display = text.includes(q) ? "" : "none";
        });
    }
}

/* ensure fields start empty on first load */
window.addEventListener("load", () => {
    document.getElementById("login-username").value = "";
    document.getElementById("login-password").value = "";
});
</script>

</body>
</html>
